<!DOCTYPE html>
<html>
	<head>
		<title>Frame View. Standard List.</title>
         <style>
        <!--
            .nodeContainer,
            .atomContainer      { font-size:10pt; background-color: #EEF5FA; padding: 10px; margin: 20px;}

            .nodeContainer      { width: 300px;}
            .atomContainer      { background-color: #DAE8F6; margin: 20px auto;}

            .nodeContainer a,
            .atomContainer a    { font-size:9pt; width: 100%; text-align: right; display:block;}


        -->
       </style>
		<script src="../coreStreams/Content.js"></script>
		<script src="../coreStreams/Frame.js"></script>
		<script>

			var frame = new Frame();

            /*
    		var colorInactive = '#eeeeee';
			var colorSelected = '#8888ff';
			var selectedNode = new function()
			{
				var uuid = null;
				var control = null;

				this.get = function()
				{
					return uuid;
				};

				this.getAtom = function()
				{
					// TODO: implement returning proper index from radio group
					return 0;
				};

				this.set = function(newUuid, newControl)
				{
					if (control)
					{
						control.style.background = colorInactive;
					}
					uuid = newUuid;
					control = newControl;
					if (control)
					{
						control.style.background = colorSelected;
					}
				};

				this.reset = function()
				{
					this.set(null, null);
				};
			};

			function refreshList(nodeViewContainer)
			{
				var frameControl = new FrameControl(frame);
				nodeViewContainer.innerHTML = '';
				selectedNode.reset(); // TODO: implement saving selection after refreshing.

				var matrix = frameControl.getMatrix();
				for (var nodeId in matrix)
				{
					var nodeControl = frameControl.getNodeControl(nodeId);
					var nodeButton = document.createElement('button');
					var captionHTML = '';
					var imax = nodeControl.getAtomsCount();
					for (var i = 0; i < imax; ++i)
					{
						captionHTML +=
						'<input type="radio" name="' + nodeId + '" value="' + i + '"' +
						(i === 0 ? ' checked>' : '>') +
						nodeControl.getAtomControl(i).getContent() +
						'<br>';
					}
					nodeButton.style.background = colorInactive;
					nodeButton.onclick = function(currentNodeId, currentNodeButton)
					{
						return function()
						{
							if (selectedNode.get() != currentNodeId)
							{
								selectedNode.set(currentNodeId, currentNodeButton);
							}
							else
							{
								selectedNode.set(null, null);
							}
						};
					}(nodeId, nodeButton);
					nodeButton.innerHTML = captionHTML;
					nodeViewContainer.appendChild(nodeButton);
					nodeViewContainer.appendChild(document.createElement('br'));
				}
			}
            */

			function FrameContainer()
			{
				this.reset = function()
				{
					;
				};

				this.addNode = function()
				{
					;
				};

				this.delNode = function()
				{
					;
				};

				this.addAtom = function()
				{
					;
				};

				this.delAtom = function()
				{
					;
				};

				this.refresh = function()
				{
					;
				};
			}

			var frameContainer = new FrameContainer();

			function onClickLoadJSON(nodeList, source)
			{
				var initNodes;
				try
				{
					initNodes = JSON.parse(source.value).nodes;
				}
				catch (e)
				{
					console.log('Can not parse given content string as JSON. String: ' + source + '; Name: ' + e.name + '; Desc: ' + e.message);
					initNodes = {};
				}
				frame = new Frame(initNodes);
				frameContainer.refresh(); // TODO: implement refreshing to fix JSON loading.
			}

			function onClickSaveJSON(destination)
			{
				var frameControl = new FrameControl(frame);
				destination.value = frameControl.stringify();
			}

			function onClickNewNode(nodeList)
			{
				var frameControl = new FrameControl(frame);
                var nodeId = frameControl.add();

				var nodeContainer = document.createElement('div');
                nodeContainer.innerHTML = '<p>NodeId: ' + nodeId + '</p>';
                nodeContainer.innerHTML += '<a href="javascript:void(0);" onclick="javascript:onClickDelNode(\'' + nodeId + '\');">del node</a>';
                nodeContainer.innerHTML += '<a href="javascript:void(0);" onclick="javascript:onClickNewAtom(\'' + nodeId + '\');">add atom</a>';
                nodeContainer.setAttribute('class', 'nodeContainer');
                nodeContainer.setAttribute('id', nodeId);
				nodeList.appendChild(nodeContainer);
			}

			function onClickDelNode(nodeId)
			{
				var frameControl = new FrameControl(frame);
				var result = frameControl.remove(nodeId);
                if (result)
                {
                    var nodeContainer = document.getElementById(nodeId);
                    nodeContainer.parentNode.removeChild(nodeContainer);
                }
			}

			function onClickNewAtom(nodeId)
			{
				var frameControl = new FrameControl(frame);
				var nodeControl = frameControl.getNodeControl(nodeId);
				if (nodeControl !== null)
				{
				    var index = nodeControl.add();

                    var atomContainer = document.createElement('div');
                    atomContainer.innerHTML = '<p>Atom</p>';
                    atomContainer.innerHTML += '<a href="javascript:void(0);" onclick="javascript:onClickDelAtom(\'' + nodeId + '\', \'' + index + '\');">del atom</a>';
                    atomContainer.innerHTML += '<a href="javascript:void(0);" onclick="javascript:onClickRenameAtom(\'' + nodeId + '\', \'' + index + '\');">change content</a>';
                    atomContainer.innerHTML += '<p id="content_atom_' + index + '"></p>';
                    atomContainer.setAttribute('class', 'atomContainer');
                    atomContainer.setAttribute('id', nodeId + '_atom_' + index);
                    var nodeContainer = document.getElementById(nodeId);
					nodeContainer.appendChild(atomContainer);
				}
			}

			function onClickRenameAtom(nodeId, atomIndex) // TODO: fix function name
			{
				var frameControl = new FrameControl(frame);
				var nodeControl = frameControl.getNodeControl(nodeId);
                if (nodeControl === null)
                	return;
				var atomControl = nodeControl.getAtomControl(atomIndex);
                if (atomControl === null)
                	return;
				atomControl.setContent('new atom name'); // TODO: implement real renaming!

                var atomContant = document.getElementById('content_atom_' + atomIndex);
                atomContant.innerHTML = atomControl.getContent();
			}

			function onClickAtomLink(nodeList)
			{
				alert(nodeList);
			}

			function onClickAtomLinkType(nodeList)
			{
				alert(nodeList);
			}

			function onClickDelAtom(nodeId, atomIndex)
			{
				var frameControl = new FrameControl(frame);
				var nodeControl = frameControl.getNodeControl(nodeId);
				if (nodeControl !== null)
                {
                    var result = nodeControl.remove( atomIndex );
                    if (result)
                    {
                        var nodeContainer = document.getElementById(nodeId);
                        var atomContainer = document.getElementById(nodeId + '_atom_' + atomIndex);
                        nodeContainer.removeChild(atomContainer);
                    }
                }
			}
		</script>
	</head>
	<body>
		<div id="frameView">
			<div id="commands">
				<button onclick="onClickNewNode(document.getElementById('nodeList'));">new node</button>
				;
				<button onclick="onClickAtomLink(document.getElementById('nodeList'));">atom set abstract link</button>
				<button onclick="onClickAtomLinkType(document.getElementById('nodeList'));">atom set link type</button>
				;
				<textarea id="loadInput"></textarea>
				<button onclick="onClickLoadJSON(document.getElementById('nodeList'), document.getElementById('loadInput'));">load from JSON</button>
				;
				<textarea id="saveOutput"></textarea>
				<button onclick="onClickSaveJSON(document.getElementById('saveOutput'));">save to JSON</button>
			</div>
			<div><br></div>
			<div id="nodeList">
			</div>
		</div>
	</body>
</html>