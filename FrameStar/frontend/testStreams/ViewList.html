<!DOCTYPE html>
<html>
	<head>
		<title>Frame View. List.</title>
		<script src="../coreStreams/Content.js"></script>
		<script src="../coreStreams/Frame.js"></script>
		<script>
			var colorInactive = '#eeeeee';
			var colorSelected = '#8888ff';
			var frame = new Frame();

			var selectedNode = new function()
			{
				var uuid = null;
				var control = null;

				this.get = function()
				{
					return uuid;
				}

				this.set = function(newUuid, newControl)
				{
					if (control)
					{
						control.style.background = colorInactive;
					}
					uuid = newUuid;
					control = newControl;
					if (control)
					{
						control.style.background = colorSelected;
					}
				};

				this.reset = function()
				{
					this.set(null, null);
				};
			};

			function refreshList()
			{
				var frameControl = new FrameControl(frame);
				var nodeViewContainer = document.getElementById('nodeList');
				nodeViewContainer.innerHTML = '';

				var matrix = frameControl.getMatrix();
				for (var nodeId in matrix)
				{
					var nodeControl = frameControl.getNodeControl(nodeId);
					var nodeButton = document.createElement('button');
					var caption = '';
					var imax = nodeControl.getAtomsCount();
					for (var i = 0; i < imax; ++i)
					{
						caption += nodeControl.getAtomControl(i).getContent() + '<br>';
					}
					nodeButton.style.background = colorInactive;
					nodeButton.onclick = function()
					{
						// TODO: fix bug with improper nodeControl and nodeButton.
						if (selectedNode.get() != nodeControl.getId())
						{
							selectedNode.set(nodeControl.getId(), nodeButton);
						}
						else
						{
							selectedNode.set(null, null);
						}
					}
					nodeButton.innerHTML = caption;
					nodeViewContainer.appendChild(nodeButton);
					nodeViewContainer.appendChild(document.createElement('br'));
				}
			}

			function onClickLoadJSON(source)
			{
				var initNodes;
				try
				{
					initNodes = JSON.parse(source.value).nodes;
				}
				catch (e)
				{
					console.log('Can not parse given content string as JSON. String: ' + source + '; Name: ' + e.name + '; Desc: ' + e.message);
					initNodes = {};
				}
				frame = new Frame(initNodes);
				refreshList();
			}

			function onClickSaveJSON(destination)
			{
				var frameControl = new FrameControl(frame);
				destination.value = frameControl.stringify();
			}

			function onClickNewNode(nodeList)
			{
				var frameControl = new FrameControl(frame);
				frameControl.add();
				refreshList();
			}

			function onClickNewAtom(nodeList)
			{
				alert(nodeList);
			}

			function onClickDelNode(nodeList)
			{
				alert(nodeList);
			}

			function onClickDelAtom(nodeList)
			{
				alert(nodeList);
			}

			function onClickRenameAtom(nodeList)
			{
				alert(nodeList);
			}

			function onClickAtomAbstract(nodeList)
			{
				alert(nodeList);
			}

			function onClickAtomConcrete(nodeList)
			{
				alert(nodeList);
			}
		</script>
	</head>
	<body>
		<div id="frameView">
			<div id="commands">
				<button onclick="onClickNewNode(document.getElementById('nodeList'));">new node</button>
				<button onclick="onClickNewAtom(document.getElementById('nodeList'));">new atom</button>
				<button onclick="onClickDelNode(document.getElementById('nodeList'));">del node</button>
				<button onclick="onClickDelAtom(document.getElementById('nodeList'));">del atom</button>
				<button onclick="onClickRenameAtom(document.getElementById('nodeList'));">rename atom</button>
				<button onclick="onClickAtomAbstract(document.getElementById('nodeList'));">atom set abstracts</button>
				<button onclick="onClickAtomConcrete(document.getElementById('nodeList'));">atom set concretes</button>
				;
				<textarea id="loadInput"></textarea>
				<button onclick="onClickLoadJSON(document.getElementById('loadInput'));">load from JSON</button>
				;
				<textarea id="saveOutput"></textarea>
				<button onclick="onClickSaveJSON(document.getElementById('saveOutput'));">save to JSON</button>
			</div>
			<div><br></div>
			<div id="nodeList">
			</div>
		</div>
	</body>
</html>